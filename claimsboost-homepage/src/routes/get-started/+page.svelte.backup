<script>
	import { goto } from '$app/navigation';
	import { fly } from 'svelte/transition';
	import { cubicOut } from 'svelte/easing';

	let currentStep = $state(1);
	let direction = $state(1); // 1 for forward, -1 for backward
	let responses = $state({
		injuryType: '',
		incidentDate: '',
		incidentLocation: '',
		medicalTreatment: '',
		fault: '',
		name: '',
		email: '',
		phone: ''
	});

	const totalSteps = 5;

	const injuryTypes = [
		{ id: 'auto-accident', label: 'Auto Accident' },
		{ id: 'slip-fall', label: 'Slip & Fall' },
		{ id: 'workplace', label: 'Workplace Injury' },
		{ id: 'medical', label: 'Medical Malpractice' },
		{ id: 'other', label: 'Other Personal Injury' }
	];

	const medicalTreatmentOptions = [
		{ id: 'emergency', label: 'Emergency Room Visit' },
		{ id: 'hospital', label: 'Hospital Stay' },
		{ id: 'doctor', label: 'Doctor Visits' },
		{ id: 'physical-therapy', label: 'Physical Therapy' },
		{ id: 'none', label: 'No Medical Treatment Yet' }
	];

	const faultOptions = [
		{ id: 'other-party', label: 'Another Person' },
		{ id: 'business', label: 'A Business/Property Owner' },
		{ id: 'employer', label: 'My Employer' },
		{ id: 'unclear', label: "I'm Not Sure" }
	];

	function goBack() {
		if (currentStep > 1) {
			direction = -1;
			currentStep--;
		} else {
			goto('/');
		}
	}

	function nextStep() {
		if (canProceed()) {
			direction = 1;
			if (currentStep < totalSteps) {
				currentStep++;
			} else {
				handleSubmit();
			}
		}
	}

	function canProceed() {
		switch (currentStep) {
			case 1:
				return responses.injuryType !== '';
			case 2:
				return responses.incidentDate !== '' && responses.incidentLocation !== '';
			case 3:
				return responses.medicalTreatment !== '';
			case 4:
				return responses.fault !== '';
			case 5:
				return responses.name !== '' && responses.email !== '' && responses.phone !== '';
			default:
				return false;
		}
	}

	function handleSubmit() {
		console.log('Survey responses:', responses);
		goto('/thank-you');
	}

	function selectOption(field, value) {
		responses[field] = value;
	}

	function handleKeyDown(event) {
		if (event.key === 'Enter' && canProceed()) {
			event.preventDefault();
			nextStep();
		} else if (event.key === 'ArrowLeft' && currentStep > 1) {
			event.preventDefault();
			goBack();
		}
	}

	$effect(() => {
		window.addEventListener('keydown', handleKeyDown);
		return () => {
			window.removeEventListener('keydown', handleKeyDown);
		};
	});

	$effect(() => {
		// Auto-focus first input on form steps
		if (currentStep === 2) {
			document.getElementById('incidentDate')?.focus();
		} else if (currentStep === 5) {
			document.getElementById('name')?.focus();
		}
	});
</script>

<section class="survey">
	<!-- Header -->
	<header class="survey-header">
		<div class="header-content">
			<a href="/">
				<img src="/claimsboost-logo.png" alt="ClaimsBoost" class="logo" />
			</a>
			<a href="tel:8888660849" class="phone-button">
				<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
				</svg>
				<span class="phone-number">(888) 866-0849</span>
			</a>
		</div>
	</header>

	<!-- Progress Bar -->
	<div class="progress-bar-container">
		<div class="progress-bar" style="width: {(currentStep / totalSteps) * 100}%"></div>
	</div>

	<div class="survey-container">
		<div class="survey-card">
			<!-- Step 1: Injury Type -->
			{#if currentStep === 1}
				<div class="step-content">
					<h1 class="step-title">What type of injury do you have?</h1>

					<div class="options-list">
						{#each injuryTypes as type}
							<button
								class="option-button {responses.injuryType === type.id ? 'selected' : ''}"
								onclick={() => selectOption('injuryType', type.id)}
							>
								<span class="option-label">{type.label}</span>
								{#if responses.injuryType === type.id}
									<svg class="checkmark" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
										<polyline points="20 6 9 17 4 12"/>
									</svg>
								{/if}
							</button>
						{/each}
					</div>
				</div>
			{/if}

			<!-- Step 2: Incident Details -->
			{#if currentStep === 2}
				<div class="step-content">
					<h1 class="step-title">When and where did the incident occur?</h1>

					<div class="form-fields">
						<div class="form-group">
							<label for="incidentDate">Date of Incident</label>
							<input
								id="incidentDate"
								type="date"
								bind:value={responses.incidentDate}
								class="form-input"
								max={new Date().toISOString().split('T')[0]}
							/>
						</div>

						<div class="form-group">
							<label for="incidentLocation">Zip Code</label>
							<input
								id="incidentLocation"
								type="text"
								bind:value={responses.incidentLocation}
								placeholder="e.g., 27601"
								class="form-input"
								maxlength="5"
							/>
						</div>
					</div>
				</div>
			{/if}

			<!-- Step 3: Medical Treatment -->
			{#if currentStep === 3}
				<div class="step-content">
					<h1 class="step-title">What medical treatment have you received?</h1>

					<div class="options-list">
						{#each medicalTreatmentOptions as option}
							<button
								class="option-button {responses.medicalTreatment === option.id ? 'selected' : ''}"
								onclick={() => selectOption('medicalTreatment', option.id)}
							>
								<span class="option-label">{option.label}</span>
								{#if responses.medicalTreatment === option.id}
									<svg class="checkmark" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
										<polyline points="20 6 9 17 4 12"/>
									</svg>
								{/if}
							</button>
						{/each}
					</div>
				</div>
			{/if}

			<!-- Step 4: Fault/Liability -->
			{#if currentStep === 4}
				<div class="step-content">
					<h1 class="step-title">Who was at fault for your injury?</h1>

					<div class="options-list">
						{#each faultOptions as option}
							<button
								class="option-button {responses.fault === option.id ? 'selected' : ''}"
								onclick={() => selectOption('fault', option.id)}
							>
								<span class="option-label">{option.label}</span>
								{#if responses.fault === option.id}
									<svg class="checkmark" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
										<polyline points="20 6 9 17 4 12"/>
									</svg>
								{/if}
							</button>
						{/each}
					</div>
				</div>
			{/if}

			<!-- Step 5: Contact Information -->
			{#if currentStep === 5}
				<div class="step-content">
					<h1 class="step-title">How can we send you your estimate?</h1>

					<div class="form-fields">
						<div class="form-group">
							<label for="name">Full Name</label>
							<input
								id="name"
								type="text"
								bind:value={responses.name}
								placeholder="John Doe"
								class="form-input"
							/>
						</div>

						<div class="form-group">
							<label for="email">Email Address</label>
							<input
								id="email"
								type="email"
								bind:value={responses.email}
								placeholder="john@example.com"
								class="form-input"
							/>
						</div>

						<div class="form-group">
							<label for="phone">Phone Number</label>
							<input
								id="phone"
								type="tel"
								bind:value={responses.phone}
								placeholder="(555) 123-4567"
								class="form-input"
							/>
						</div>
					</div>
				</div>
			{/if}

			<!-- Next Button -->
			<div class="button-container">
				<button
					class="next-button"
					onclick={nextStep}
					disabled={!canProceed()}
				>
					Next
				</button>
			</div>
		</div>
	</div>

	<!-- Footer -->
	<footer class="survey-footer">
		<div class="footer-content">
			<p class="copyright">Â© 2013-2025 ClaimsBoost, Inc. All rights reserved.</p>
			<p class="disclaimer">ClaimsBoost connects injury victims with qualified personal injury attorneys.</p>
			<div class="footer-links">
				<a href="/privacy">Privacy Policy</a>
				<a href="/terms">Terms of Service</a>
				<a href="/privacy-choices">Your privacy choices</a>
			</div>
		</div>
	</footer>
</section>

<style>
	.survey {
		min-height: 100vh;
		background: #ffffff;
		padding: 0;
		display: flex;
		flex-direction: column;
	}

	.survey-header {
		background: white;
		padding: 16px 20px;
		border-bottom: 1px solid #e5e5e5;
	}

	.header-content {
		max-width: 1000px;
		margin: 0 auto;
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.survey-header a {
		display: inline-block;
	}

	.logo {
		max-height: 49px;
		width: auto;
		object-fit: contain;
	}

	.phone-button {
		display: flex;
		align-items: center;
		gap: 8px;
		padding: 10px 16px;
		background: linear-gradient(135deg, #60A5FA 0%, #2563EB 100%);
		border: none;
		border-radius: 8px;
		text-decoration: none;
		color: white;
		transition: all 0.3s ease;
		box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3), 0 2px 4px rgba(0, 0, 0, 0.1);
	}

	.phone-button:hover {
		background: linear-gradient(135deg, #7BB8FF 0%, #3B82F6 100%);
		box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4), 0 3px 6px rgba(0, 0, 0, 0.15);
		transform: translateY(-2px);
	}

	.phone-number {
		font-weight: 500;
		display: none;
	}

	@media (min-width: 640px) {
		.phone-number {
			display: inline;
		}
	}

	.progress-bar-container {
		width: 100%;
		height: 9px;
		background: #e5e5e5;
		position: relative;
	}

	.progress-bar {
		height: 100%;
		background: linear-gradient(90deg, #60A5FA 0%, #2563EB 100%);
		transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
		box-shadow:
			0 2px 10px rgba(96, 165, 250, 0.48),
			0 0 20px rgba(96, 165, 250, 0.4),
			0 0 30px rgba(37, 99, 235, 0.24);
		position: relative;
	}

	.progress-bar::after {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: inherit;
		filter: blur(4px);
		opacity: 0.3;
		z-index: -1;
	}

	.survey-container {
		max-width: 1000px;
		margin: 0 auto;
		padding: 0;
		width: 100%;
		flex: 1;
	}

	.survey-card {
		background: white;
		padding: 40px 20px;
		min-height: calc(100vh - 120px);
		display: flex;
		flex-direction: column;
	}

	.step-content {
		flex: 1;
		max-width: 612px;
		margin: 0 auto;
		width: 100%;
	}

	.step-title {
		font-size: 28px;
		font-weight: 700;
		color: #1a1a1a;
		margin-bottom: 32px;
		line-height: 1.3;
	}

	.options-list {
		display: flex;
		flex-direction: column;
		gap: 16px;
		margin-bottom: 40px;
	}

	.option-button {
		display: flex;
		align-items: center;
		justify-content: space-between;
		width: 100%;
		padding: 18px 20px;
		background: white;
		border: 2px solid #d1d5db;
		border-radius: 8px;
		cursor: pointer;
		transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
		text-align: left;
		font-size: 16px;
		box-shadow: 0 2px 8px rgba(0,0,0,0.18);
	}

	.option-button:hover {
		border-color: #9ca3af;
		transform: translateY(-2px);
		box-shadow: 0 4px 16px rgba(0,0,0,0.22);
	}

	.option-button:focus {
		outline: none;
	}

	.option-button.selected {
		border-color: #2563EB;
		background: #eff6ff;
	}

	.option-label {
		flex: 1;
		font-weight: 500;
		color: #1a1a1a;
	}

	.checkmark {
		flex-shrink: 0;
		color: #2563EB;
	}

	.form-fields {
		display: flex;
		flex-direction: column;
		gap: 24px;
		margin-bottom: 40px;
	}

	.form-group {
		display: flex;
		flex-direction: column;
		gap: 8px;
	}

	.form-group label {
		font-size: 14px;
		font-weight: 600;
		color: #1a1a1a;
	}

	.form-input {
		padding: 14px 16px;
		border: 2px solid #d1d5db;
		border-radius: 8px;
		font-size: 16px;
		transition: border-color 0.2s;
		font-family: inherit;
		background: white;
	}

	.form-input:focus {
		outline: none;
		border-color: #2563EB;
	}

	.button-container {
		max-width: 612px;
		margin: 0 auto;
		width: 100%;
		display: flex;
		justify-content: flex-end;
	}

	.next-button {
		padding: 16px 32px;
		background: linear-gradient(135deg, #FF7B00 0%, #D85A00 100%);
		color: white;
		border: none;
		border-radius: 8px;
		font-size: 16px;
		font-weight: 600;
		cursor: pointer;
		transition: all 0.3s ease;
		min-width: 180px;
		box-shadow: 0 4px 15px rgba(255, 123, 0, 0.4), 0 2px 4px rgba(0, 0, 0, 0.1);
		display: inline-flex;
		align-items: center;
		justify-content: center;
		gap: 8px;
	}

	.next-button:hover:not(:disabled) {
		background: linear-gradient(135deg, #FF9500 0%, #E06500 100%);
		box-shadow: 0 6px 25px rgba(255, 123, 0, 0.5), 0 3px 6px rgba(0, 0, 0, 0.15);
		transform: translateY(-2px);
	}

	.next-button:disabled {
		opacity: 0.5;
		cursor: not-allowed;
		transform: none;
	}

	@media (max-width: 768px) {
		.survey-card {
			padding: 32px 20px;
		}

		.step-title {
			font-size: 24px;
			margin-bottom: 24px;
		}

		.button-container {
			justify-content: stretch;
		}

		.next-button {
			width: 100%;
			min-width: 0;
		}
	}

	@media (min-width: 769px) {
		.survey-card {
			padding: 60px 40px;
		}

		.step-title {
			font-size: 32px;
		}

		.button-container {
			position: relative;
			bottom: 40px;
		}
	}

	.survey-footer {
		background: #f8f9fa;
		padding: 32px 20px;
		margin-top: auto;
		border-top: 1px solid #e5e5e5;
	}

	.footer-content {
		max-width: 1000px;
		margin: 0 auto;
		text-align: center;
	}

	.copyright {
		font-size: 13px;
		color: #666;
		margin-bottom: 8px;
	}

	.disclaimer {
		font-size: 12px;
		color: #666;
		margin-bottom: 16px;
	}

	.footer-links {
		display: flex;
		justify-content: center;
		gap: 20px;
		flex-wrap: wrap;
	}

	.footer-links a {
		font-size: 12px;
		color: #666;
		text-decoration: underline;
		transition: color 0.2s;
	}

	.footer-links a:hover {
		color: #1a1a1a;
	}
</style>
